[[archivos/bibliografia/Tema2Redes.pdf|Tema2Redes]]
[[2.1 Ejercicios Capa de Aplicación]]

# 2.1 Introducción
La capa de aplicación se ocupa de la **comunicación entre procesos.** El esquema típico se muestra en la siguiente figura:

![[archivos/imagenes/Pasted image 20241108210200.png]]

> [!Recordatorio]
> ![[archivos/imagenes/Pasted image 20241108205726.png]]
>


## 2.1.1 Protocolo de comunicación
La comunicación de dos procesos, tanto en el **mismo host** como en hosts diferentes, se hace **enviando mensajes**. Para que los mensajes sean comprendidos hay que establecer un **protocolo**.

El **protocolo** facilita la programación. Hay que programar tanto las funciones de envío como las de recepción y si tenemos un protocolo claro de programación será más fácil.

**Especificaciones del protocolo:**
- **Qué mensajes hay**, típicamente qué repeticiones e pueden hacer y qué respuestas les corresponden
- **Las reglas** que especifican cuando se **envían o responden** mensajes.
- La **sintaxis del mensaje**, es decir, los campos de que consta
- La **semántica de cada campo**, su significado.

## 2.1.2 Servicios que necesita la aplicación de red
Los protocolos de la capa de aplicación utilizan por debajo los protocolos básicos proporcionados por la capa de transporte. Como vimos en el tema anterior, estos son: **TCP y UDP**, TCP proporciona un servicio **fiable** y UDP un servicio **sencillo y rapido, pero no garantiza la recepción**.

| Protocolo | Aplicaciones        |
| --------- | ------------------- |
| **TCP**   | HTTP (web)          |
|           | SMTP, POP3 (correo) |
|           | FTP (ficheros)      |
| **UDP**   | DNS (traducciones)  |

> [!Nota]
Denominamos **agente de usuario**, a la interfaz entre el usuario y la aplicación. O sea el programa gráfico que permite al usuario trabajar cómodamente con la aplicación, por ejemplo **firefox**.

# 2.2 Protocolo de Transferencia de Hipertexto HTTP
Este protocolo define la comunicación entre un servidor y un cliente web. Usa **TCP** y el por defecto, el **puerto 80**.

Una **página web** usualmente consta de varios objetos, es decir, de varios **ficheros**:

| **Objetos** | documento base    |
| ----------- | ----------------- |
|             | imagenes          |
|             | animaciones flash |
|             | programas java    |
Cuando un **navegador** solicita una **página web**, el primer objeto que se devuelve es el **documento base**, que contiene el layout de la página usualmente también el texto. El **layout** indica cómo conseguir lo restantes objetos y dónde han de colocarse. 

> [!OJO]
> Sin el **layout** no podemos saber como obtener el resto de objetos de la página web

## 2.2.1 Tipos de conexiones HTTP
Dependiendo de como se realicen las conexiones para conseguir los distintos objetos, se distinguen las siguientes conexiones **HTTP**:

### Conexiones No Persistentes
Con **conexiones no persistentes** se utiliza una conexión **TCP** distinta para transferir cada uno de los objetos. Con **conexiones persistentes** se pueden transferir varios objetos e incluso varias páginas con la misma conexión **TCP**. Pueden ser o en **serie** o **paralelas**.

#### En serie
Son en **serie** si se espera a que acabe la **conexión TCP** previa antes de que comience la siguiente. 

![[archivos/imagenes/Pasted image 20240929184416.png]]

#### Paralelas
 Son **paralelas** si se inician varias **conexiones TCP** a la vez.
 
![[archivos/imagenes/Pasted image 20240929184609.png]]

### Conexiones Persistentes
Con **conexiones persistentes** se utiliza la misma **conexión TCP** para conseguir **varios objetos** o incluso varias **páginas web** diferentes. Típicamente el **servidor** cierra la **conexión TCP** cuando no ha sido utilizada durante cierto tiempo.
Existen dos versiones de **conexiones persistentes**:

#### Sin Entubamiento
En la versión **sin entubamiento**, el cliente sólo pide un nuevo objeto cuando el previo ha sido recibido.


#### Con Entubamiento
En la versión **con entubamiento** el cliente puede hacer peticiones de varios objetos antes de recibir los anteriores. El modo por defecto de **HTTP/1.1**  es **persistente con entubamiento**.

![[archivos/imagenes/Pasted image 20240929184949.png]]

## 2.2.2 Tiempo de transferencia de una página web
El transferencia del primer objeto $2RTT +Ttransmision$, esto se debe a que necesitamos conocer el **layout** de la página web para obtener el resto de objetos. En cambio, **el tiempo de transferencia** de los siguientes objetos depende del tipo de conexión.

![[archivos/imagenes/Pasted image 20241005172705.png]]

- **Tiempo de ida y vuelta (*RTT round-trip time*):** Es el tiempo necesario para que un paquete pequeño vaya de **cliente a servidor y de nuevo al cliente**. Incluye todos los posibles retardos: *tiempo de propagación en los enlaces, espera en las colas y procesamiento en los routers.* Ya tenemos el tiempo de un bit.
- **Tiempo de transmisión del fichero:** Es el tiempo necesario para **almacenar y reenviar** un fichero y como es lógico depende del tamaño del fichero.
$$t_{\text{trans}} = \frac{L}{R}$$
- **Tiempo total para transmitir un paquete:** 

$$\text{Tiempo total} = RTT + t_{\text{trans}}$$

## 2.2.3 Mensajes HTTP
El protocolo HTTP define cómo se envían y reciben mensajes entre un cliente (por ejemplo, un navegador web) y un servidor (el sitio web al que se accede). Estos mensajes se separan en **cabeceras** (headers) y un **cuerpo** (body), donde la cabecera contiene información de control y el cuerpo contiene los datos solicitados o enviados, como páginas web o imágenes.

#### Peticiones y Respuestas HTTP
El protocolo HTTP tiene dos tipos principales de mensajes:
1. **Peticiones (Request)**: El cliente las envía al servidor para solicitar recursos, como páginas web o imágenes.
2. **Respuestas (Response)**: El servidor responde con los recursos solicitados o con información sobre el éxito o fracaso de la petición.

#### Mensaje HTTP de Petición
![[archivos/imagenes/Pasted image 20241005175747.png]]

El significado de estos campos es el siguiente:
- **método**: `GET` (página normal) o `POST` (formulario)
- **sp**: espacio, en formato ASCII7
- **URL**: la dirección del objeto que se requiere
- **versión**: versión de HTTP en uso
- **cr**: retorno de carro, `\r`
- **lf**: salto de línea `\n`
- **nombreCampo**: puede haber varias líneas de este tipo. Esta variable puede ser:
  - `Host` (para el nombre del servidor)
  - `Connection` (que puede valer “close”, para conexiones no persistentes)
  - `User-agent` (nombre del navegador en uso)
  - `Accept-language` (el idioma preferido por el solicitante)
- **valor**: para cada posible `nombreCampo` también tiene que especificarse el valor que toma
- **cuerpo**: en caso de que `método=POST`, contiene los datos del formulario

Esta estructura permite que el servidor entienda qué acción debe realizar, sobre qué recurso y con qué parámetros adicionales.

#### Mensaje HTTP de Respuesta

![[archivos/imagenes/Pasted image 20241005180931.png]]

El significado de estos campos es similar al de los mensajes de petición, pero:
- **cod**: es la codificación de la frase (por ejemplo, `200, OK`; `404, Not Found`; `400, Bad Request`)
- **nombreCampo**: ahora puede ser:
  - `Connection` (igual que en los de petición)
  - `Date` (fecha de envío)
  - `Server` (servidor que envía el objeto)
  - `Last-Modified` (fecha de la última modificación del objeto)
  - `Content-Length` (tamaño en bytes)
  - `Content-Type` (tipo de contenido del objeto, como una extensión)
- **cuerpo**: los datos del objeto que se envía

> [! Info]
> Las **cookies** son pequeñas piezas de datos que un servidor web envía al navegador de un usuario y que el navegador guarda localmente. Cada vez que el usuario vuelve a visitar el sitio, el navegador incluye esas cookies en la solicitud HTTP, permitiendo que el servidor "recuerde" al usuario.
> 
> 1. Cuando un usuario visita un sitio web, el servidor crea una **cookie** con un identificador único y se la envía al navegador.
>2. El navegador guarda esta cookie en un archivo de cookies.
>3. En visitas futuras, el navegador envía esta cookie al servidor junto con las solicitudes HTTP, lo que permite al servidor reconocer al usuario.
>
>Cuando "Susana" visita Amazon, el servidor de Amazon le asigna un identificador (por ejemplo, "1678") y lo guarda en su base de datos junto con cualquier otra información relevante. Este ID se almacena en una cookie en el navegador de Susana. La próxima vez que Susana visite Amazon, su navegador enviará la cookie, y el servidor podrá identificarla y ofrecerle contenido personalizado.
>
>Las cookies permiten a los sitios web identificar a los usuarios, recordar preferencias y mantener sesiones (por ejemplo, el carrito de compras en Amazon). Sin embargo, también plantean preocupaciones de privacidad, ya que permiten el seguimiento de la actividad del usuario en la web.


# 2.3 FTP: Protocolo Transferencia Ficheros
El **FTP (File Transfer Protocol)** es un protocolo diseñado para la **transferencia de archivos** entre un cliente y un servidor. A diferencia de otros protocolos, **FTP** utiliza **dos conexiones TCP en paralelo**: una para el **control** y otra para la **transferencia de datos**. A continuación, te explico cada uno de sus elementos de forma más clara:

#### Conexión de Control (Puerto 21)
La **conexión de control** es la que se utiliza para gestionar la sesión FTP, enviando y recibiendo **comandos** entre el cliente y el servidor. Este canal permanece **abierto durante toda la sesión**, es decir, **es persistente**.

- **Comandos transmitidos**: Se envían comandos como *nombre de usuario, contraseña, solicitar directorios, pedir archivos, cerrar la sesión, etc.*.
- **Formato de los comandos**: Los comandos son legibles, utilizando texto ASCII de 7 bits, y se componen de palabras de 4 letras en mayúsculas seguidas de parámetros (si los hay). Ejemplo: `USER`, `PASS`, `LIST`, `RETR`.
- **Respuestas del servidor**: El servidor responde con **códigos de 3 dígitos** (que indican el resultado de los comandos) acompañados de una **explicación en texto**. Ejemplo: `230 User logged in, proceed.`

La conexión de control **se mantiene activa** durante toda la sesión de FTP, incluso cuando no se están transfiriendo datos.

#### Conexión de Datos (Puerto 20)
La **conexión de datos** se encarga de transferir los archivos o listas de directorios entre el cliente y el servidor. A diferencia de la conexión de control, esta conexión **no es persistente**, es decir, **se abre y se cierra** cada vez que se necesita transferir un archivo o realizar alguna operación que implique datos (como listar directorios).

- **Datos transmitidos**: Puede ser el contenido de los archivos que se están transfiriendo o el resultado de comandos como `LIST` (que devuelve un listado de archivos y directorios).
- **Formato de transmisión**: Los datos se transmiten en **binario**, lo que permite transferir cualquier tipo de archivo (texto, imágenes, vídeos, etc.) sin pérdida de información.
- **Apertura y cierre**: Cada vez que se necesita enviar o recibir un archivo, se establece una nueva conexión TCP para los datos y se cierra al finalizar la transferencia.

#### Protocolo con Estado
**FTP es un protocolo con estado**, lo que significa que el servidor mantiene información sobre la sesión mientras está activa. Entre los datos que guarda están:

- El **nombre del usuario** que ha iniciado sesión.
- El **directorio actual** en el que el usuario está navegando.
- Otros detalles que permiten al servidor recordar el contexto de la sesión hasta que el usuario cierra la conexión.

Esto es necesario para que el servidor pueda gestionar múltiples usuarios y archivos de forma ordenada.

#### Comandos y Respuestas en FTP
Los **comandos FTP** que envía el cliente son cadenas de texto simples, normalmente de una **palabra de cuatro caracteres** en mayúsculas (como `USER`, `PASS`, `LIST`, `RETR`, `STOR`), y cada uno va acompañado de una acción específica.


Por ejemplo:
- `USER <nombre>`: Enviar el nombre de usuario para autenticar.
- `PASS <clave>`: Enviar la contraseña.
- `LIST`: Listar los archivos del directorio actual.
- `RETR <archivo>`: Descargar un archivo desde el servidor.
- `STOR <archivo>`: Subir un archivo al servidor.

Las **respuestas del servidor** siguen un formato estándar de **códigos de tres dígitos**, que indican el estado de la operación, seguidos de un mensaje explicativo:

- `200`: Operación exitosa.
- `230`: Usuario autenticado correctamente.
- `550`: Error, archivo no encontrado o sin permisos.

#### Seguridad en FTP
Una de las limitaciones importantes de FTP es que **no cifra los datos**, incluyendo el **nombre de usuario y la contraseña** que se envían por la red. Esto significa que, en una red insegura, alguien podría interceptar y leer esa información.


#### Resumen de las conexiones en FTP

| **Conexión** | **Propósito**                               | **Puerto** | **Persistencia** | **Formato de datos**  |
| ------------ | ------------------------------------------- | ---------- | ---------------- | --------------------- |
| **Control**  | Enviar comandos y recibir respuestas        | 21         | Persistente      | Texto ASCII (legible) |
| **Datos**    | Transferir archivos o listas de directorios | 20         | No persistente   | Binario               |

# 2.4 SMTP: Protocolo Transferencia. Correo Sencillo

![[archivos/imagenes/Pasted image 20241012131936.png]]

El **SMTP (Simple Mail Transfer Protocol)** es el protocolo estándar para la **transferencia de correo electrónico** entre servidores. SMTP se encarga de **enviar correos** desde el cliente (el remitente) hacia un servidor de correo, y también entre servidores de correo. Veamos en detalle cómo funciona este protocolo y cómo se integra en el sistema de correo:

#### Características Técnicas de SMTP
- **Puerto utilizado**: SMTP utiliza el **puerto 25** para comunicarse entre servidores de correo.
- **Conexiones TCP persistentes**: Al igual que FTP, SMTP mantiene una **conexión TCP persistente** mientras dure la sesión de envío del correo.
- **Formato de los mensajes**: Los correos y comandos que se envían a través de SMTP utilizan **ASCII de 7 bits**, por lo que los mensajes y las instrucciones son legibles por humanos.

#### Funcionamiento: Envío y Recepción
El **sistema de correo electrónico** consta de varias partes:

1. **Agente de usuario (Mail User Agent, MUA)**: Es el programa que los usuarios utilizan para gestionar su correo, como **Outlook**, **Thunderbird** o los clientes de correo de un navegador web (Gmail, Yahoo, etc.). El agente de usuario permite:
   - Escribir correos electrónicos.
   - Enviarlos a través de un servidor de correo.
   - Descargar correos recibidos desde un servidor, usando otros protocolos como **POP3**, **IMAP**, o incluso **HTTP** (en el caso de interfaces web).

   Es importante notar que el **buzón de correo** (donde se almacenan los correos que recibes) no está en el ordenador local, sino en un **servidor remoto**. Esto es útil porque los correos pueden llegar en cualquier momento del día, mientras que el ordenador del usuario no siempre está encendido o conectado a internet.

2. **Servidor de correo (Mail Transfer Agent, MTA)**: Cuando el usuario envía un correo, su agente de usuario lo **transfiere al servidor de correo**. Este servidor de correo se encarga de **procesar** y **enviar** el correo al servidor de destino adecuado. Aquí es donde entra en juego **SMTP**.
   
   El servidor de correo **origen** examina la dirección de destino y utiliza el protocolo **SMTP** para buscar el **servidor de correo destino**. Una vez identificado, transfiere el correo a dicho servidor, donde queda almacenado en el **buzón del destinatario**.

**SMTP** está diseñado para facilitar la **comunicación entre servidores de correo**. Aunque teóricamente la comunicación es directa entre dos servidores (origen y destino), en la práctica puede haber **servidores intermedios** que retransmitan los correos, especialmente si hay problemas de red o fallos temporales.

#### Proceso de Envío de Correo
1. **El usuario escribe un correo** en su agente de usuario y lo envía.
2. **El agente de usuario** lo transfiere al servidor de correo origen.
3. **El servidor de correo origen** utiliza **SMTP** para establecer una conexión con el servidor de correo destino.
4. **SMTP** transmite el correo del servidor origen al servidor destino, donde el mensaje queda almacenado en el buzón del destinatario.
5. **El destinatario** puede, en cualquier momento, acceder a su correo y descargarlo mediante protocolos como **POP3**, **IMAP**, o directamente a través de un navegador web usando **HTTP**.

![[archivos/imagenes/Pasted image 20241012133330.png]]

#### Gestión de Errores y Retransmisiones
SMTP también maneja casos en los que no se puede entregar el correo de inmediato:

- Si el **servidor de correo destino** está **fuera de servicio** o no responde, el servidor origen pone el mensaje en una **cola de espera**.
- El servidor de correo intentará reenviar el correo cada cierto tiempo (generalmente, cada 30 minutos).
- Si después de varios intentos fallidos (normalmente, varios días) el correo no ha podido ser entregado, el servidor envía un **mensaje de error** de vuelta al remitente, informando que el correo no ha podido ser entregado.

#### Mensajes SMTP
SMTP (Simple Mail Transfer Protocol) utiliza tres tipos principales de mensajes para la comunicación entre el **cliente** (quien envía el correo) y el **servidor** (quien lo recibe):

- **Comandos**
  - `HELO` (nombre del servidor)
  - `MAIL FROM` (dirección del remitente)
  - `RCPT TO` (dirección de destino)
  - `DATA` (contenido)
  - `QUIT`
  
- **Respuestas**
  - Con códigos numéricos y frases aclaratorias

- **Datos**
  - Son el contenido de los correos, con todos los objetos encapsulados



#### Seguridad en SMTP
SMTP, tal como se diseñó originalmente, es un **protocolo inseguro** porque no solicita autenticación del remitente. Esto significa que cualquier cliente puede conectarse a un servidor SMTP y enviar correos a cualquier destinatario sin identificarse, lo que facilita la creación de **spam** (correos no deseados).


# 2.5 Protocolos de Acceso al Correo
Una vez que un correo ha llegado al **buzón de destino**, el siguiente paso es transferirlo al ordenador local del usuario. Para esto, no se utiliza SMTP, ya que este protocolo está diseñado para enviar correos (es un protocolo de oferta) y requeriría que el ordenador local estuviera siempre encendido y conectado a Internet, esperando la llegada de mensajes. Por lo tanto, se han diseñado protocolos específicos para **descargar correos**, siendo **POP3**, **IMAP** y **HTTP** los más comunes. Aquí nos centraremos en **POP3**.

#### Funcionamiento de POP3
**POP3** (Post Office Protocol 3) permite a los usuarios descargar correos desde un servidor a su ordenador local. El proceso se basa en **tres tipos de mensajes** que se intercambian entre el **agente de usuario** (cliente) y el **servidor de correo**:

- **Comandos** (de 4 caracteres)
  - `user` (nombre de usuario)
  - `pass` (palabra clave)
  - `list`
  - `retr` (número de correo, para traer correo)
  - `dele` (número de correo)
  - `quit`
  
- **Respuestas**
  - `OK` o `ERR`, con frases explicativas

- **Datos**
  - La lista de mensajes, los contenidos de los correos, o el correo completo en un único mensaje


#### Características de POP3
- **Puerto**: POP3 utiliza el **puerto 110** para la comunicación.
- **Conexiones persistentes**: Durante una sesión de POP3, se utiliza una única conexión TCP que puede ser mantenida abierta mientras el usuario descarga varios correos. Esto ahorra tiempo y recursos en comparación con abrir y cerrar conexiones repetidamente.
- **Autenticación**: A diferencia de SMTP, que permite enviar correos sin necesidad de una cuenta, POP3 requiere que el usuario tenga una cuenta y una contraseña válidas. Esto significa que el servidor verifica la identidad del usuario antes de permitir el acceso a los correos, lo que ayuda a prevenir el acceso no autorizado.

#### Modos de Operación de POP3
- **Descargar y borrar**: Con el comando `RETR` seguido de `DELE`, los correos son descargados y luego eliminados del servidor.
- **Descargar y mantener**: Solo se utiliza el comando `RETR`, permitiendo que los correos permanezcan en el servidor después de ser descargados.

#### Resumen
POP3 es un protocolo eficiente y seguro para la transferencia de correos, permitiendo a los usuarios gestionar su correspondencia sin necesidad de mantener sus dispositivos siempre conectados. Su estructura de comandos y respuestas proporciona un método sencillo para acceder a los mensajes, lo que lo convierte en una opción popular para el acceso a correos en muchos entornos.


# 2.6 DNS: Servicio de Nombres de Dominio
Nosotros en Internet, para poder comunicar a un cliente y a un servidor, necesitamos conocer ambos sockets. Si recordamos, los sockets están formados por **IP:Puerto**. Entonces, ¿cómo podemos conocer la IP destino de una página web? Para eso tenemos los **DNS**.

> [!INFO]
> Con el comando `ping dominio` obtenemos la ip de un determinado dominio
>

El **Sistema de Nombres de Dominio (DNS)** es fundamental para el funcionamiento de Internet, ya que se encarga de traducir los nombres de host (como `www.ejemplo.com`) a direcciones IP (como `192.0.2.1`) y viceversa. Este sistema permite que los usuarios accedan a sitios web utilizando nombres fáciles de recordar en lugar de tener que memorizar largas cadenas de números.

#### Protocolo Sin Conexión
- **UDP**: DNS utiliza el protocolo **UDP** (User Datagram Protocol), específicamente el **puerto 53**. Esto se debe a que DNS no necesita mantener el estado de las conexiones. Cada host tiene una lista de direcciones de servidores de nombres, generalmente configurada durante la instalación del sistema operativo.
  
- **Mecanismo de Consulta**: Cuando un host necesita realizar una traducción, se dirige al primer servidor de la lista. Si no recibe respuesta, se mueve al siguiente, y así sucesivamente. Esta estrategia permite que DNS sea más eficiente, ya que, en lugar de intentar reestablecer una conexión con el primer servidor, busca otros.

#### Servicios Proporcionados por DNS
1. **Traducción de Nombres**: Realiza traducciones de nombres de hosts a direcciones IP y viceversa, permitiendo obtener alias de hosts.

2. **Información de Servidores Autorizados**: Indica qué servidor está autorizado para proporcionar información sobre un dominio específico, lo que es crucial para la administración de dominios.

3. **Alias de Servidores de Correo**: Permite simplificar direcciones de correo electrónico. Por ejemplo, `usc.es` puede ser un alias para el servidor de correo `smtp.usc.es`, facilitando la escritura de direcciones como `peptio@usc.es`.

4. **Distribución de Carga**: Un mismo nombre de host puede tener múltiples direcciones IP asociadas, lo cual es útil para servidores espejo (servidores que tienen el mismo contenido). DNS puede configurarse para devolver estas direcciones IP de manera rotativa.

#### Elementos del DNS
1. **Servidores de Nombres**: El DNS se compone de numerosos servidores de nombres distribuidos por Internet. Estos servidores trabajan en conjunto para traducir los nombres de dominio en direcciones IP.

2. **Base de Datos Distribuida**: La base de datos del DNS está organizada de manera jerárquica. Por ejemplo, para la traducción del nombre de host `jerez.dec.usc.es`, la jerarquía es la siguiente:
   - **Servidor de Primer Nivel**: Maneja el dominio de nivel superior (TLD), como `.es`.
   - **Servidor de Segundo Nivel**: Maneja el dominio `usc`.
   - **Servidor de Tercer Nivel**: Maneja el dominio `dec`.
   - Cada nivel tiene sus propios servidores responsables de almacenar y proporcionar la información correspondiente.

3. **Protocolo de Consulta**: El DNS utiliza un protocolo que permite a los hosts (computadoras) solicitar traducciones a los servidores de nombres y que los servidores intercambien información entre ellos.


#### Tipos de Servidores DNS
1. **Servidores Locales**: Son los que manejan las consultas de los hosts en una red local. Cada host tiene una lista de estos servidores, que a menudo son proporcionados por el ISP (Proveedor de Servicios de Internet). El host comienza consultando el primer servidor de la lista.

2. **Servidores Autorizados y No Autorizados**: 
   - **No Autorizados**: Son instalados por particulares o empresas y no están registrados en el sistema global del DNS. Solo se conocen internamente y se utilizan dentro de una red local.
   - **Autorizados**: Deben ser registrados en el DNS global para que los nombres de los hosts sean accesibles desde Internet. Estos servidores son típicamente proporcionados por el ISP y cada host debería estar registrado en al menos dos servidores autorizados para garantizar fiabilidad.

3. **Servidores Raíz**: Hay un número limitado de servidores raíz en Internet que proporcionan información sobre los dominios de nivel superior (como `.com`, `.org`, `.es`). Si se pregunta a un servidor raíz sobre el dominio `.es`, proporcionará información sobre servidores de nombres en ese dominio.

4. **Servidores Intermedios**: Estos servidores proporcionan información sobre dominios de niveles intermedios (como `usc.es`). Si se le pregunta a un servidor en la raíz sobre el dominio `usc.es`, puede proporcionar información sobre un servidor en la Universidad de Santiago.

> [!INFO]
> Un **dominio** es un nombre que identifica a un sitio web en Internet. Es una parte fundamental de la dirección de un sitio web y se utiliza para acceder a recursos en la red de manera fácil y comprensible para los usuarios. Por ejemplo, en la URL `www.ejemplo.com`, `ejemplo.com` es el dominio.
> 

#### Tipos de Consultas
- **Consultas Recursivas**: En este tipo de consulta, cada servidor de nombres se encarga de interrogar al siguiente hasta obtener la respuesta final. Esto permite que el servidor de nombres local maneje la totalidad de la consulta.
![[archivos/imagenes/Pasted image 20241013171148.png]]

> [!Nota] 
> Servidor intermedio es lo mismo que Servidor TLD.


- **Consultas Iterativas**: En este caso, el servidor de nombres local se pone en contacto con todos los servidores necesarios para obtener la información. A diferencia de las consultas recursivas, el servidor local no delega la consulta a otros servidores.
![[archivos/imagenes/Pasted image 20241013171228.png]]

#### Caché DNS
Cuando un servidor DNS obtiene una traducción, almacena una copia en su memoria local (disco o RAM) para futuras consultas. Esta caché se utiliza para responder a consultas repetidas de manera más rápida. Las entradas de la caché se eliminan después de un tiempo específico (generalmente, cada dos días).

#### Mensajes DNS
Existen **dos tipos de mensajes** en el DNS: **Consultas** y **Respuestas**. Ambos mensajes tienen un formato similar, que consta de una cabecera con información de control y un cuerpo que contiene las consultas y respuestas.

![[archivos/imagenes/Pasted image 20241013171434.png]]

1. **Cabecera**: Contiene 6 campos, algunos de los cuales son en binario:
   - **Identificación**: Un número de 16 bits que identifica la consulta, permitiendo que un host realice múltiples consultas simultáneamente.
   - **Señales**: 4 bits que indican el tipo de mensaje (consulta o respuesta), si la respuesta proviene de un servidor autorizado, si se requiere una consulta recursiva, etc.
   - **Tamaño de Campos del Cuerpo**: Indica la cantidad de preguntas, respuestas, servidores autorizados y datos adicionales en el mensaje.

2. **Cuerpo**: Consta de 4 campos:
   - **Cuestiones**: Preguntas que incluyen el nombre o dirección IP a traducir.
   - **Respuestas**: Respuestas obtenidas, como pares de nombres de host y direcciones IP. Un nombre de host puede corresponder a múltiples direcciones IP.
   - **Servidores Autorizados**: Indica los servidores de nombres autorizados que se pueden consultar para un dominio específico.
   - **Información Adicional**: Incluye datos que no fueron solicitados explícitamente.
 ![[archivos/imagenes/Pasted image 20241013171414.png]]


# 2.7 Distribución de contenidos
La distribución de contenidos se refiere a las diversas técnicas utilizadas para gestionar y entregar contenidos digitales (como páginas web, archivos de audio, video, etc.) de manera eficiente, reduciendo el tiempo de carga y mejorando la experiencia del usuario. A continuación, se explican los conceptos clave en esta área:

## 2.7.1 Introducción 
Los accesos a servidores centralizados pueden ser lentos por dos razones principales:
- **Congestión de red**: El camino que siguen los mensajes puede estar congestionado, lo que provoca retrasos.
- **Sobrecarga del servidor**: Un servidor puede estar manejando demasiadas peticiones al mismo tiempo.

Para abordar estas limitaciones, se utilizan métodos alternativos a los servidores centralizados. En lugar de almacenar todos los contenidos en un solo servidor, se distribuyen y duplican en diferentes ubicaciones geográficas, dirigiendo las peticiones al servidor que ofrezca el menor tiempo de respuesta.

## 2.7.2 Caché Web (Servidor Proxy)
La caché web implica la utilización de un servidor intermedio, conocido como **proxy**, que gestiona todas las peticiones web de los usuarios en una red. Este servidor proxy normalmente es proporcionado por el proveedor de servicios de Internet (ISP). Aquí se explica el funcionamiento:

![[archivos/imagenes/Pasted image 20241013173230.png]]

- **Funcionamiento**: 
  - Los usuarios envían sus peticiones web al proxy, que luego redirige esas solicitudes a los servidores web de destino.
  - Cuando el proxy recibe el contenido de los servidores, lo almacena en su caché y lo reenvía a los usuarios.
  - Las próximas peticiones para el mismo contenido se satisfacen a partir de la caché local, mejorando significativamente el tiempo de respuesta.
  
- **Configuración**: 
  - Los usuarios deben configurar sus navegadores para utilizar el servidor proxy, indicando la dirección del mismo.
  
- **Jerarquía de Caché**: 
  - Puede haber un esquema jerárquico de proxies, donde varios proxies se comunican entre sí para optimizar aún más la distribución.

![[archivos/imagenes/Pasted image 20241013173336.png]]

---

## 2.7.3 Redes de Distribución de Contenidos (CDN)
Las **CDN** son empresas que poseen una infraestructura de múltiples servidores distribuidos globalmente. Estas empresas no crean contenido, sino que alquilan su infraestructura a otras organizaciones. Por ejemplo, Akamai replica contenidos de sitios como El País en sus centros de hospedaje.

#### Técnicas de Acceso a Contenidos en una CDN:
- **Redirección de Objetos**: 
  - Los documentos base de un sitio web están en el servidor del cliente, pero contienen enlaces que redirigen a los objetos almacenados en los servidores CDN.
  
- **Balanceo de Cargas mediante DNS**: 
  - Al traducir un nombre de dominio a una dirección IP, el DNS selecciona automáticamente el servidor CDN más cercano o rápido.
---
## 2.7.4 Redes P2P (de Igual a Igual)
Las **redes P2P** permiten a los usuarios actuar tanto como clientes como servidores, compartiendo archivos entre sí. Al unirse a una red P2P, los usuarios pueden descargar y compartir contenido desde sus propios discos duros. 

#### Directorio Centralizado
##### Funcionamiento
- **Estructura**: En este modelo, un único host en Internet se encarga de construir y almacenar el directorio de contenidos. Este host centralizado se convierte en el punto de referencia para todos los usuarios de la red P2P.
  
- **Interacción del Usuario**: Cuando un usuario inicia la aplicación P2P (como Napster), primero se conecta al host central. Este usuario envía su lista de archivos compartidos al servidor central, que luego agrega estos datos al directorio general.

- **Consulta de Contenidos**: Cuando un usuario busca un archivo, su consulta es enviada al host central, que responde con las direcciones IP de otros usuarios que tienen el contenido solicitado. Este proceso permite que los usuarios se conecten directamente entre sí para compartir archivos.

- **Actualización del Directorio**: El directorio se actualiza constantemente. Si un usuario obtiene un contenido, su estado cambia a servidor del mismo, y si deja de estar activo, se elimina de la base de datos.

##### Problemas
1. **Único Punto de Fallo**: Si el host central falla (por ejemplo, se apaga o es atacado), toda la red se vuelve inoperativa, ya que no hay un respaldo para las peticiones.

2. **Cuello de Botella**: El servidor central debe manejar un alto volumen de tráfico, lo que puede provocar lentitud en las respuestas, especialmente si hay millones de usuarios realizando consultas simultáneamente.

3. **Infracción de Copyright**: Al ser un host centralizado, puede ser objeto de demandas legales. Si el host es propiedad de una empresa, esta puede ser responsable del contenido compartido en su plataforma.

#### Directorio Descentralizado
##### Funcionamiento
- **Estructura**: En este modelo, el directorio de archivos se distribuye entre varios usuarios en lugar de estar concentrado en un solo host. Algunos de estos usuarios son designados como "líderes" del grupo, basándose en criterios como velocidad de conexión y antigüedad en la red.

![[archivos/imagenes/Pasted image 20241013173858.png]]

- **Responsabilidad de los Líderes**: Cada líder gestiona consultas dentro de su grupo asignado. Si no puede resolver una consulta, la redirige a otros líderes conectados. Esto permite una gestión más eficiente de las peticiones y reduce la carga en un único punto.

![[archivos/imagenes/Pasted image 20241013173929.png]]

- **Red de Superposición**: La red de usuarios se organiza en una estructura jerárquica que permite que la información fluya entre los diferentes líderes, lo que mejora la resiliencia de la red.

##### Ventajas
1. **Eliminación del Punto de Fallo**: Si un líder falla, otros pueden asumir su papel, lo que significa que la red sigue operando sin interrupciones significativas.

2. **Menor Congestión**: Al distribuir las consultas y los contenidos, se reduce la carga en un único servidor, lo que minimiza la latencia y mejora el tiempo de respuesta.

3. **Menos Riesgo Legal**: Al no haber un solo propietario del contenido, es más difícil para las autoridades demandar a un único ente.

---

#### Inundación de Consultas
##### Funcionamiento
- **Estructura**: En este modelo, no existe un directorio; en cambio, las consultas se transmiten de usuario a usuario. Cada usuario retransmite su búsqueda a otros usuarios conectados, hasta que se encuentra el contenido solicitado.

- **Estrategia de Búsqueda**: Las consultas se inician desde un usuario y se envían a todos los nodos vecinos en la red. Cada nodo que recibe la consulta también la retransmite a sus vecinos, creando un "efecto de inundación".

##### Problemas
1. **Alto Tráfico**: Este método puede generar un tráfico enorme en la red, ya que las consultas pueden inundar todos los nodos, lo que puede causar congestión y ralentización.

2. **Limitación de Profundidad**: Para mitigar el problema del tráfico, se puede limitar la profundidad de la inundación. Esto significa que las consultas solo se propagan hasta un número específico de nodos. Cuando se alcanza ese límite, la búsqueda se detiene.

##### Ejemplo
- **Gnutella**: Es un ejemplo de red P2P que utiliza este enfoque. Aunque permite una búsqueda directa de contenido, la inundación de consultas puede resultar en un uso ineficiente del ancho de banda.

---

#### Descarga de Archivos
##### Segmentación de Descargas

- **Eficiencia**: En aplicaciones como BitTorrent, la descarga de archivos se puede mejorar al dividir el archivo en segmentos. Un usuario puede descargar un segmento y, mientras tanto, compartirlo con otros usuarios, lo que permite que el archivo completo se descargue más rápidamente y se comparta entre varios nodos simultáneamente.

![[archivos/imagenes/Pasted image 20241013174117.png]]

#### Conclusión
Las redes P2P, con sus diferentes arquitecturas de directorio, ofrecen maneras únicas de distribuir y compartir contenidos. Mientras que los sistemas centralizados presentan ventajas en términos de simplicidad, los sistemas descentralizados y de inundación ofrecen más resiliencia y eficiencia en la distribución, aunque también con sus propios desafíos. Esto resalta la evolución de las aplicaciones P2P y su adaptación a las necesidades de los usuarios y a la infraestructura de Internet.
