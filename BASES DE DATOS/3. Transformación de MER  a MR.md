[[../Archivos/bibliografia/bases_datos.pdf|bases_datos.pdf#page=147]]

[[3.1 Casos Transformación MER a MR]]

# Introducción
Por una parte, tenemos el Modelo Entidad-Relación que, como hemos visto, resulta muy útil para expresar los conceptos del mundo real que queremos incorporar en la Base de Datos sin necesidad de tener que pensar en qué Gestor de Bases de Datos vamos a utilizar en el desarrollo del proyecto. Por otra parte, **los Gestores de Bases de Datos más habituales implementan el Modelo Relacional**.

Aunque se pueden desarrollar Bases de Datos en cualquiera de los dos modelos, conforme el tamaño del modelo va creciendo las ventajas de usar **Modelo Entidad-Relación** se vuelven más evidentes: El modelo es más **entendible visualmente** y, además, resulta sencillo aplicar estrategias del tipo **“divide y vencerás”** para resolver partes del modelo y unirlas en una etapa final de integración.

En este tema vamos a ver cómo obtener un Modelo Relacional válido a partir de un Modelo Entidad-Relación correcto. Si el Modelo Entidad-Relación es correcto, la aplicación estricta de las normas que estudiaremos en este tema generaran un Modelo Relacional correcto. Siempre. Correcto, **pero no necesariamente óptimo**.

# Transformación  a Modelo Relacional del Modelo Entidad Relación Básico

## Representación de los conjuntos de entidades fuertes con atributos simples
Sea *E* un conjuntos de **entidades fuertes** con los **atributos descriptivos** *a1,a2,...,an*. Esta entidad se representa mediante un esquema *E* con *n* atributos distintos. Cada **tupla** de las relaciones de este esquema corresponde a una entidad del conjunto de entidades *E*.

Para los esquemas derivados de los conjuntos de entidades fuertes, la **clave primaria del conjunto de entidades sirve de clave primaria de los esquemas resultantes**. Esto se deduce directamente del hecho de que cada tupla corresponde a una entidad concreta del conjunto de entidades.

Como ejemplo, tenemos el conjunto de entidades *préstamo* del diagrama *E-R*. Este conjunto tiene 3 atributos: *ID, nombre y tot_cred*. Este conjunto de entidades se representa mediante un esquema denominado *estudiante*, con tres atributos : *estudiante(==ID==, nombre, tot_cred)*
Como ID es la clave primaria del conjunto de entidades, también es la clave primaria del esquema de relación.

## Representación de los conjuntos de entidades fuertes con atributos complejos.

Cuando un **conjunto de entidades fuertes** tiene un conjunto de atributos que **no son simples**, las cosas son un poco más complicadas. Hemos tratado los atributos compuestos creado atributos separados para cada uno de los atributos componente, no creamos un atributo separado para la composición de sus atributos compuestos.  

Ejemplo: conjunto de entidades *profesor* , para el **atributo compuesto** *nombre*, el esquema generado para *profesor* contiene los atributos *nombre, ap1, ap2*; no existen atributos separados en e esquema para *nombre*. De forma similar, para el atributo compuesto *dirección* el esquema generado contiene los atributos *calle, ciudad, provincia y código postal.* Como *calle* es atributo compuesto **se sustituye** por *calle_nombre, calle_número y piso*. 

Los **atributos multivalorados** se tratan de forma diferente al resto de atributos. Ya se ha visto que los atributos de un diagrama **E-R** se corresponden directamente con los atributos de los esquemas de relación apropiados. Sin embargo, los atributos multivalorados son una excepción; **se crean nuevos esquemas de relación para ellos**, como se verá en breve.

Los **atributos derivados** no se representan explícitamente en el modelo de datos relacional. Sin embargo, se representan como *métodos* en otros modelos de datos, como el modelo de datos **objeto-relacional**.

Como resultado obtenemos: *profesor( ID, nombre, ap1, ap2, calle_nombre, calle_número, piso, ciudad, provincia, código_ postal, fecha_de_nacimiento)*

Para un **multivalorado** *M* se crea un esquema de relación *R* con un atributo A que corresponde a M y a los atributos correspondientes ala clave primaria del conjunto de entidades o de relaciones del que *M* es atributo.
Tenemos el conjunto de entidades *profesor* con el atributo multivalorados *número_teléfono*. La clave primaria de *profesor* es *ID*. Para este **atributo multivalorado** se crea el esquema de relación:
*profesor_teléfono(==ID, número_teléfono==)*
Cada número de teléfono de un profesor se representa como una única tupla de la relación de este esquema, en este caso podríamos tener las tuplas:
*(2222, 555-1234)*
*(2222,555-4321)*
Reflejando que el profesor con *ID = 2222* tiene tanto el *número_teléfono = 555-1234* y el *número_teléfono = 555-4321*

Además debemos crear una **clave externa** para que el esquema de la relación, a partir del **atributo multivalorado** generado por efecto de la clave primaria del conjunto de entidades que hace referencia a la relación generada desde el conjunto de entidades. En este caso el atributo *ID* debe hacer referencia ala relación *profesor*.

En caso de que el **conjunto de entidades** constara solo de dos atributos, un atributo de clave primaria *B* y un **único atributo multivalorado** *M*, el esquema de relación para el conjunto de entidades debería contener solamente un atributo, el atributo de **clave primaria B**. Se puede eliminar esta relación manteniendo el esquema de relación con el atributo *B* y el atributo *A* que corresponda con *M*.

## Representación de los conjuntos de entidades débiles
Sea *A* un conjunto de entidades débiles con los atributos *a1, a2,...,am* . Sea *B* el conjunto de entidades fuertes del que *A* depende. La calve primaria de *B* consiste en los atributos *b1,b1,...,bn*. EL conjunto de entidades *A* se representa mediante el esquema de relación denominado *A* con un atributo por cada miembro del conjunto.

Para los esquemas derivados de conjuntos de entidades débiles la **combinación** de la **clave primaria** del conjunto de entidades fuertes y del **discriminador** del conjunto de entidades débiles sirve de **clave primaria del esquema**. Además también se crea una restricción de **clave externa** para la relación *A*, que especifica que los atributos d *B* hacen referencia a la calve primaria de la relación *B*.  La restricción de **clave externa** garantiza que por cada **tupla** que representa a una entidad débil existe la tupla correspondiente que representa a la entidad fuerte correspondiente.

Ejemplo: conjunto de **entidades débiles** *sección*. Este conjunto de entidades tiene los atributos: *secc_idd, semestre y año*. La calve primaria del conjunto de entidades *sección*, de la que depende *sección*, es *asignatura_id*. Por tanto, *sección* se representa mediante un esquema con los siguientes atributos:
*seccion( asignatura_id, secc_id, semestre, año)*

La **clave primaria** consiste en la calve primaria del conjunto de entidades asignatura y el discriminador de sección, que es *secc_id, semestre y año* . También se crea una **restricción** de clave externa
para el esquema sección, con el atributo asignatura_id, que hace
referencia a la clave primaria del esquema asignatura, y la **restricción de integridad** «on delete cascade». Por la especificación
«on delete cascade» sobre la restricción de clave externa, **si una**
**entidad de asignatura se borra, entonces también se borran las entidades sección asociadas.**

## Representación de conjuntos de relaciones

Sea *R* un conjunto de relaciones con un conjunto de atributos formado por la unión de las claves primarias de cada uno de los conjuntos de entidades que participan en *R* con sus correspondientes atributos. EL conjunto de relaciones se representa mediante el esquema de relación *R* , con un atributo por cada uno de los miembros del conjunto.

Para escoger la clave primaria:
- Para **relaciones binarias carios a varios** la **unión** de los atributos de calve primaria de los conjuntos de entidades participantes pasa a ser la calve primaria.
- Para los conjuntos de **relaciones binarias uno a uno** la calve primaria de **cualquiera** de los conjuntos de entidades puede escoger como **clave primaria**
- Para los conjuntos de **relaciones binarias varios a uno o uno a varios** la **clave primaria** del conjunto de entidades de la parte *varios* de la relación sirve de clave primaria.
- Para los conjuntos de **relaciones n-arias** sin flechas en las líneas la **unión** de los atributos de la clave primaria de los conjuntos de entidades participantes pasa a ser la calve primaria
- Para los conjuntos de **relaciones n-arias** con una flecha en una de las líneas, las calves primarias de lo conjuntos de entidades que no están en el lado *flecha* del conjunto de relaciones sirven de calve primaria del esquema. 
También se crean **restricciones de clave externa** para el esquema de relación *R* de la siguiente forma: para cada conjunto de entidades *Ei* relacionado con el conjunto de relaciones R se crea una
restricción de clave externa de la relación R, con los atributos de R
que se derivan de los atributos de clave primaria de *Ei* que hacen
referencia a la clave primaria del esquema de relación que representa *Ei*.

Ejemplo tenemos el conjunto de relaciones *tutor*. Que implica a estos conjuntos de entidades:
- *profesor* con clave primaria *ID*
- *estudiante* con calve primaria *ID*
Como el conjunto de relaciones no tiene ningún atributo, el esquema *tutor* tiene dos atributos, las claves primarias de *profesor y estudiante*. Como el conjunto de relaciones de *tutor* es del tipo varios a uno, se renombra a *p_ID y e_ID*.

Y además creamos las restricciones de clave externa correspondientes.

### Redundancia de esquemas
En general, el esquema de los conjuntos de relaciones que enla-
zan los conjuntos de entidades débiles con su conjunto correspon-
diente de entidades fuertes es redundante y no hace falta que esté
presente en el diseño de la base de datos relacional basado en el
diagrama E-R.

### Combinación de esquemas
Considérese un conjunto *AB* de relaciones **varios a uno** del conjunto de entidades *A* al conjunto de entidades *B*. Usando el esquema de construcción de esquemas de relación descrito previamente se consiguen tres esquemas: *A, B y AB*. Entonces, los esquemas
A y B se pueden combinar para formar un solo esquema consistente en la unión de los atributos de los dos esquemas. La clave primaria del esquema combinado es la clave primaria del conjunto de entidades en cuyo esquema se combinó el conjunto de relaciones.
Ejemplo: 
*profesor_dept*. Los esquemas *profesor* y *departamento* corresponden a los conjuntos de entidades *A y B*, respectivamente. Entonces, el esquema *profesor_dept* se puede combinar con el esquema *profesor*. El *esquema* profesor resultado consta de los atributos *{ID, nombre, nombre_dept, sueldo}.*

En el caso de las relaciones uno a uno, el esquema de relación del conjunto de relaciones puede combinarse con el esquema de cualquiera de los conjuntos de entidades.
Se pueden combinar esquemas aunque la participación sea parcial, usando los valores nulos. En el ejemplo anterior, si *profesor_dept* fuese parcial se almacenarían valores nulos para el atributo *nombre_dept* de los profesores que no tuviesen asociado un departamento.

Por último, vamos a considerar las restricciones de **clave externa** que habrían aparecido en el **esquema** que representa a los conjuntos de relaciones. Habría habido restricciones de **clave externa** referenciando a cada uno de los conjuntos de entidades que participan en los conjuntos de relaciones. Se eliminan las restricciones referenciando los conjuntos de entidades en aquellos esquemas en que se combina el esquema del conjunto de relaciones, y se añade la otra restricción de clave externa al esquema combinado.
Por ejemplo, *profesor_dept* tiene una restricción de clave externa
del atributo *nombre_dept* referenciando la relación departamento.
Esta restricción externa se añade a la relación profesor cuando el
esquema *profesor_dept* se combina en profesor.

![[Archivos/imagenes/Pasted image 20241003132123.png]]
# Transformación a Modelo Relacional del Modelo Entidad-Relación Avanzado

## Representación de generalización
Existen dos métodos diferentes para designar los esquemas de relación de los diagramas *E-R* que incluyen generalización.

- Se crea un esquema para el conjunto de entidades de nivel superior. Para cada conjunto de entidades de nivel inferior se crea un esquema que incluye un atributo para cada uno de los atributos de ese conjunto de entidades más un atributo por cada atributo de la clave primaria del conjunto de entidades de nivel superior. 
	*persona(==ID==, nombre, calle, ciudad)*
	*empleado(==ID==, sueldo)*
	*estudiante(==ID==, tot_créd)*
	Los atributos de la **clave primaria del conjunto de entidades de nivel superior** pasan a ser atributos de **clase primaria** del conjunto de entidades de **nivel superior** y de todos los **conjuntos de entidades de nivel inferior.** 
	Además creamos las **restricciones de clave externa** para los conjuntos de entidades de **nivel inferior**, con sus atributos calve primaria que hacen referencia a la clave primaria de la relación creada a partir del conjunto de entidades de nivel superior. En el anterior ejemplo, el atributo *ID* de *empleado* haría referencia a la clave primaria de *persona* y lo mismo para *estudiante*.

- Es posible una representación alternativa si la generalización es **disjunta y completa**, es decir, **si no hay ninguna entidad miembro de dos conjuntos de entidades de nivel inferior** directamente por debajo de un conjunto de entidades de nivel superior, y si por todas las entidades del conjunto de entidades de nivel superior también pertenecen a uno de los conjuntos de entidades de nivel inferior. En este caso no se crea un esquema para el conjunto de entidades de nivel superior. En vez de eso, para conjunto de **entidades de nivel inferior** se crean un esquema que incluye un atributo por cada atributo de ese conjunto de entidades más un atributo por cada atributo del conjunto de entidades de nivel superior.
	*empleado(==ID==, nombre, calle, ciudad, sueldo)*
	*estudiante(==ID==, nombre, calle, cuidad, tot_cred*)

Un inconveniente del segundo método es la definición de las restricciones de **clave externa**. Esto se debe a que no tienen sitio de donde tomar el valor. Para evitar este problema hay que crear un esquema de relación *persona* que contenga, al menos, los atributos de clave primaria de la entidad *persona*.

Si se usara el segundo método para una generalización solapada, algunos valores se almacenarían varias veces de manera innecesaria. Por ejemplo, si una persona es a la vez empleado y estudiante, los valores de calle y de ciudad se almacenarían dos veces.

Si la **generalización** fuera **disjunta pero no completa**, es decir, si alguna personas no fuera ni empleado ni estudiante, entonces haría falta un esquema adicional:
*persona(==ID==, nombre, calle,ciudad)*
para poder representar a esas personas. Sin embargo seguimos con el problema de la calve externa.

## Representación de la agregación
Es sencillo. Basta con juntar los atributos de ambos conjuntos de entidades en la misma relación

![[Archivos/imagenes/Pasted image 20241003140849.png]]

# Ejemplo
![[Archivos/imagenes/Pasted image 20241010125608.png]]
![[Archivos/imagenes/Pasted image 20241010125636.png]]